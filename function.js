function onLoad(e){document.getElementById("namDev").innerHTML=nameDevice,startConnect(),startTime()}function startConnect(){var e=(new Date).getTime().toString(),t="Web_"+e.substring(e.length-10);client=new Paho.MQTT.Client(host,Number(port),t),client.onConnectionLost=onConnectionLost,client.onMessageArrived=onMessageArrived,client.connect({onSuccess:onConnect,userName:UsernameServer,useSSL:!0,password:PasswordServer}),console.log("START CONNECT..."),console.log(t)}function sendData(e){if(1==flg_Conn){var t=new Paho.MQTT.Message(e);t.destinationName=DeviceCode+"/Control",t.qos=0,client.send(t)}}function onConnect(){var e=DeviceCode+"/Data";client.subscribe(e),document.getElementById("ledL").style.color="#24A9A3",flg_Conn=1,sendData(jeso='{"comm":"PWS"}'),console.log("Connect!")}function onConnectionLost(e){flg_Conn=0,console.log("NO Connect!")}function onMessageArrived(e){var t=JSON.parse(e.payloadString);console.log(t)}function startTime(){0==flg_Conn?0==count?(document.getElementById("ledL").style.color="#D3425C",count=1):(document.getElementById("ledL").style.color="#191F2F",count=0):0==count?(document.getElementById("ledL").style.color="#24A9A3",count=1):(document.getElementById("ledL").style.color="#191F2F",count=0),coAut>0&&coAut--,0==coAut&&(coAut=-1,tIS()),setTimeout(startTime,1e3)}function rotate(e,t){document.getElementById(e).setAttribute("transform","rotate("+t+", 100, 100)")}function houColor(){curTim=3600*inHou+60*inMin,document.getElementById("hour").setAttribute("visibility","visible"),document.getElementById("minu").setAttribute("visibility","visible"),curTim>=tim[1][4]&&curTim<tim[2][4]?1==document.getElementById("onofT1").checked?(document.getElementById("hour").style.fill="#923a76",document.getElementById("tmpCir").innerHTML=tim[1][2]+"째"):(document.getElementById("hour").style.fill="#8f9392",document.getElementById("tmpCir").innerHTML="OFF"):curTim>=tim[2][4]&&curTim<tim[3][4]?1==document.getElementById("onofT2").checked?(document.getElementById("hour").style.fill="#186aa1",document.getElementById("tmpCir").innerHTML=tim[2][2]+"째"):(document.getElementById("hour").style.fill="#8f9392",document.getElementById("tmpCir").innerHTML="OFF"):curTim>=tim[3][4]&&curTim<tim[4][4]?1==document.getElementById("onofT3").checked?(document.getElementById("hour").style.fill="#96891b",document.getElementById("tmpCir").innerHTML=tim[3][2]+"째"):(document.getElementById("hour").style.fill="#8f9392",document.getElementById("tmpCir").innerHTML="OFF"):curTim>=tim[4][4]&&curTim>0&&(1==document.getElementById("onofT4").checked?(document.getElementById("hour").style.fill="#1c6342",document.getElementById("tmpCir").innerHTML=tim[4][2]+"째"):(document.getElementById("hour").style.fill="#8f9392",document.getElementById("tmpCir").innerHTML="OFF"))}function twoDigits(e){return e<10?("0"+e).slice(-2):e}function ouDiag(){var e=(60*Number(tim[1][0])+Number(tim[1][1]))/1440*100,t=(60*Number(tim[2][0])+Number(tim[2][1]))/1440*100,n=(60*Number(tim[3][0])+Number(tim[3][1]))/1440*100,m=(60*Number(tim[4][0])+Number(tim[4][1]))/1440*100,o=t-e,l=100-o,i=25-e,d=n-t,u=100-d,c=25-t,r=m-n,s=100-r,g=25-n,a=100-(o+d+r),y=a-=25-i,E=100-y,I=25-m;Tim_1.style.strokeDasharray=o+" "+l,Tim_1.style.strokeDashoffset=i,Tim_2.style.strokeDasharray=d+" "+u,Tim_2.style.strokeDashoffset=c,Tim_3.style.strokeDasharray=r+" "+s,Tim_3.style.strokeDashoffset=g,Tim_4.style.strokeDasharray=y+" "+E,Tim_4.style.strokeDashoffset=I}function CleColo(){document.getElementById("Th_1").style.color="#8f9392",document.getElementById("Tm_1").style.color="#8f9392",document.getElementById("Te_1").style.color="#7488AB";for(var e=2;e<5;e++)document.getElementById("Th_"+e).style.color="#7488AB",document.getElementById("Tm_"+e).style.color="#7488AB",document.getElementById("Te_"+e).style.color="#7488AB"}function stT(e){if("--"!==document.getElementById(e).innerHTML){"none"===document.getElementById("clav").style.display&&(document.getElementById("clav").style.display="block");var t=e.length,n=e.substring(t-1,t);selID=e,CleColo(),document.getElementById(e).style.color="#21918E",document.getElementById("tInf").innerHTML=" ",couDigit=0,memDigit=0,selID==="Th_"+n?btBkH():selID==="Tm_"+n?btBkM():selID==="Te_"+n&&btBkT()}}function btBkH(){document.getElementById("bt_0").disabled=!1,document.getElementById("bt_1").disabled=!1,document.getElementById("bt_2").disabled=!1;for(var e=3;e<10;e++)document.getElementById("bt_"+e).disabled=!0}function btBkM(){for(e=0;e<6;e++)document.getElementById("bt_"+e).disabled=!1;for(var e=6;e<10;e++)document.getElementById("bt_"+e).disabled=!0}function btRaM(){document.getElementById("bt_0").disabled=!1;for(var e=1;e<10;e++)document.getElementById("bt_"+e).disabled=!0}function btBkT(){document.getElementById("bt_0").disabled=!0,document.getElementById("bt_9").disabled=!0;for(var e=1;e<9;e++)document.getElementById("bt_"+e).disabled=!1}function btVos(){document.getElementById("bt_0").disabled=!1;for(var e=1;e<10;e++)document.getElementById("bt_"+e).disabled=!0}function btRaH2(){document.getElementById("bt_3").disabled=!1}function btRaT(){for(var e=0;e<10;e++)document.getElementById("bt_"+e).disabled=!1}function keyb(e){if(-1!=couDigit){document.getElementById("tInf").innerHTML=" ",document.getElementById("sav").className="savK",flag_Save=1;var t=selID.length,n=Number(selID.substring(t-1,t)),m=Number(e),o=Number(document.getElementById("Tm_"+n).innerHTML);selID==="Th_"+n?0==couDigit?(document.getElementById("Th_"+n).innerHTML=m,2==m?btRaH2():btRaT(),couDigit=1):(memDigit+=m,document.getElementById("Th_"+n).innerHTML=memDigit,tim[n][4]=3600*memDigit,o>0&&(o*=60,tim[n][4]+=o),sortTim(),checkTim(),couDigit=-1):selID==="Tm_"+n?0==couDigit?(o>0&&(o*=60,tim[n][4]-=o),document.getElementById("Tm_"+n).innerHTML=m,btRaM(),couDigit=1):(memDigit+=m,document.getElementById("Tm_"+n).innerHTML=memDigit,memDigit*=60,tim[n][4]+=memDigit,sortTim(),checkTim(),couDigit=-1):selID==="Te_"+n&&(0==couDigit?(document.getElementById("Te_"+n).innerHTML=m,8==m?btVos():btRaT(),couDigit=1):(memDigit+=m,document.getElementById("Te_"+n).innerHTML=memDigit,tim[n][2]=memDigit,couDigit=-1,btRaT(),CleColo())),memDigit=e}}function sortTim(){var e=Number(tim[1][4]);tim[1][0]=e/3600^0,tim[1][1]=(e-3600*tim[1][0])/60^0,e=Number(tim[2][4]),tim[2][0]=e/3600^0,tim[2][1]=(e-3600*Number(tim[2][0]))/60^0,e=Number(tim[3][4]),tim[3][0]=e/3600^0,tim[3][1]=(e-3600*Number(tim[3][0]))/60^0,e=Number(tim[4][4]),tim[4][0]=e/3600^0,tim[4][1]=(e-3600*Number(tim[4][0]))/60^0,tim.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]}),document.getElementById("Th_1").innerHTML=twoDigits(tim[1][0]),document.getElementById("Th_2").innerHTML=twoDigits(tim[2][0]),document.getElementById("Th_3").innerHTML=twoDigits(tim[3][0]),document.getElementById("Th_4").innerHTML=twoDigits(tim[4][0]),document.getElementById("Tm_1").innerHTML=twoDigits(tim[1][1]),document.getElementById("Tm_2").innerHTML=twoDigits(tim[2][1]),document.getElementById("Tm_3").innerHTML=twoDigits(tim[3][1]),document.getElementById("Tm_4").innerHTML=twoDigits(tim[4][1]),document.getElementById("Te_1").innerHTML=tim[1][2],document.getElementById("Te_2").innerHTML=tim[2][2],document.getElementById("Te_3").innerHTML=tim[3][2],document.getElementById("Te_4").innerHTML=tim[4][2]}function checkTim(){CleColo(),btRaT(),errEnter=0,tim[1][4]==tim[2][4]&&(document.getElementById("Th_1").style.color="#D3425C",document.getElementById("Tm_1").style.color="#D3425C",document.getElementById("Th_2").style.color="#D3425C",document.getElementById("Tm_2").style.color="#D3425C",errEnter=1),tim[2][4]==tim[3][4]&&(document.getElementById("Th_2").style.color="#D3425C",document.getElementById("Tm_2").style.color="#D3425C",document.getElementById("Th_3").style.color="#D3425C",document.getElementById("Tm_3").style.color="#D3425C",errEnter=1),tim[3][4]==tim[4][4]&&(document.getElementById("Th_3").style.color="#D3425C",document.getElementById("Tm_3").style.color="#D3425C",document.getElementById("Th_4").style.color="#D3425C",document.getElementById("Tm_4").style.color="#D3425C",errEnter=1),0==errEnter&&ouDiag()}function onOfT(){0==flag_Save&&(document.getElementById("sav").className="savK",flag_Save=1)}function Ned(e){if(1==flag_Save)return document.getElementById("tInf").innerHTML="PLEASE SAVE SETTINGS",void(document.getElementById("DA"+flag_w).checked=!0);var t=e.length,n=Number(e.substring(t-1,t));if(0!=flag_Edit||n!=curWeek){0==flag_Edit&&n!=curWeek?(document.getElementById("hour").setAttribute("visibility","hidden"),document.getElementById("minu").setAttribute("visibility","hidden"),document.getElementById("tmpCir").innerHTML="---",flag_Edit=1):1==flag_Edit&&n==curWeek&&(flag_Edit=0,memM=-1);for(var m=1;m<5;m++)document.getElementById("Th_"+m).innerHTML="--",document.getElementById("Tm_"+m).innerHTML="--",document.getElementById("Te_"+m).innerHTML="--";flag_w=n,sendData(jeso='{"comm":"RED","dn":"'+n+'"}')}}function sendWsSetTim(){if(1!=couDigit)if(1!=errEnter){for(var e=1;e<5;e++)1==document.getElementById("onofT"+e).checked?tim[1][3]=tim[1][3]|1<<Number(e-1):tim[1][3]=tim[1][3]&~(1<<Number(e-1));sendData(jeso='{"comm":"STI","akt":"'+tim[1][3]+'","vt2":"'+tim[2][4]+'","vt3":"'+tim[3][4]+'","vt4":"'+tim[4][4]+'","tt1":"'+tim[1][2]+'","tt2":"'+tim[2][2]+'","tt3":"'+tim[3][2]+'","tt4":"'+tim[4][2]+'","nt":"'+flag_w+'"}'),flag_Save=0,document.getElementById("tInf").innerHTML=" ",document.getElementById("sav").className="savS"}else document.getElementById("tInf").innerHTML="TIMERS COINCIDE IN TIME";else document.getElementById("tInf").innerHTML="ENTER TWO CHARACTERS"}function updTim(){if(1!=flag_Save){0==couDigit&&(CleColo(),btRaT()),flag_Edit=0,flag_w=0,memM=-1;var e,t=new Date,n=(new Date).getTimezoneOffset();e=n<0?n/-60:n/60;var m=t.getHours(),o=t.getMinutes(),l=t.getSeconds(),i=t.getFullYear(),d=t.getMonth()+1,u=t.getDate(),c=t.getDay(),r=String(i).substring(2);0==c&&(c=7),sendData(jeso='{"comm":"DAT","ho":"'+m+'","mi":"'+o+'","se":"'+l+'","ye":"'+r+'","mo":"'+d+'","da":"'+u+'","we":"'+c+'","tz":"'+e+'"}')}else document.getElementById("tInf").innerHTML="PLEASE SAVE SETTINGS"}function menu(){couHSer=0,1!=flag_Save?(CleColo(),"none"===document.getElementById("blSe").style.display?(document.getElementById("blSe").style.display="block",document.getElementById("clav").style.display="none",document.getElementById("taTi").style.display="none",document.getElementById("bRel").style.display="block",1==flag_Edit&&QueryCurDey()):document.getElementById("blSe").style.display="none"):document.getElementById("tInf").innerHTML="PLEASE SAVE SETTINGS"}function sTim(){if("none"===document.getElementById("taTi").style.display)document.getElementById("taTi").style.display="block",document.getElementById("bRel").style.display="none",document.getElementById("blSe").style.display="none";else{if(1==flag_Save)return void(document.getElementById("tInf").innerHTML="PLEASE SAVE SETTINGS");document.getElementById("taTi").style.display="none",document.getElementById("clav").style.display="none",document.getElementById("bRel").style.display="block",CleColo(),1==flag_Edit&&QueryCurDey()}}function QueryCurDey(){flag_Edit=0,flag_w=0,memM=-1,sendData(jeso='{"comm":"RED","dn":"'+curWeek+'"}')}function onOf(){0==flg_Auto?"ON"===document.getElementById("btOnOf").value?(tOf(),sendData(jeso='{"rp":"OFF"}')):(tOnK(),sendData(jeso='{"rp":"ON"}')):1==flg_Auto&&(tIK(),coAut=3)}function tOf(){document.getElementById("btOnOf").value="OFF",document.getElementById("btOnOf").className="btOnOf"}function tOn(){document.getElementById("btOnOf").className="btOnOr",document.getElementById("btOnOf").value="DELAY"}function tOnK(){document.getElementById("btOnOf").value="ON",document.getElementById("btOnOf").className="btOn"}function tIK(){document.getElementById("lbAu").innerHTML="AUTO MODE",document.getElementById("lbAu").style.color="#D3425C"}function tIS(){document.getElementById("lbAu").innerHTML="RELAY ON/OFF",document.getElementById("lbAu").style.color="#8f9392"}function AutHa(){2!=flg_Auto&&3!=flg_Auto&&(0==flg_Auto?tAu():tHa(),tOf(),flg_SavAuHisDel=1,SendSetup())}function tAu(){flg_Auto=1,document.getElementById("auha").className="aut",document.getElementById("lbHA").innerHTML="AUTO MODE",document.getElementById("lbHA").style.color="#8f9392"}function tHa(){flg_Auto=0,document.getElementById("auha").className="nabs",document.getElementById("lbHA").innerHTML="HAND MODE",document.getElementById("lbAu").innerHTML="PUMP-1 ON/OFF",document.getElementById("lbAu").style.color="#8f9392"}function SetHis(e){document.getElementById("labHis").innerHTML="Hysteresis "+e+"째";var t=(e-0)/4*100;document.getElementById("prHi").style.width=t+"%"}function HisSave(){SendSetup()}function SetDel(e){document.getElementById("labDel").innerHTML="Delay "+e+"s.";var t=(e-0)/90*100;document.getElementById("prDe").style.width=t+"%"}function DelSave(){flg_SavAuHisDel=2,SendSetup()}function CoHe(){flg_SavAuHisDel=1,SendSetup()}function SendSetup(){var e=0;e=1==document.getElementById("hea").checked?0:1,sendData(jeso='{"comm":"STR","au":"'+flg_Auto+'","bm":"'+e+'","hi":"'+document.getElementById("slidHistt").value+'","dl":"'+document.getElementById("slidDel").value+'","pr":"'+flg_SavAuHisDel+'"}'),flg_SavAuHisDel=0}var host="m15.cloudmqtt.com",UsernameServer="cxjuzzzn",PasswordServer="Jevkda5wZkhl",port=32669,DeviceCode="3030F97714A0",nameDevice="NO NAME",tim=[[0,0,0,0,0],[0,0,40,0,0],[6,0,28,0,21600],[12,0,65,0,43200],[18,0,34,0,64800]],inHou=0,inMin=0,couDigit=-1,memDigit=0,selID,flg_Auto=0,curTim=0,coAut=-1,count=0,flg_Conn=0,copIP="",apIP="",memO=-1,memT=200,memA=-1,memD=-1,memM=-1,flag_Edit=0,flag_Save=0,flg_SavAuHisDel=0,errEnter=0,curWeek=0,flag_w=0,couHSer=0,jeso;window.addEventListener("load",onLoad)